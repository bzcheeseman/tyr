git:
  depth: 1
  quiet: true

language: c++

os: osx
osx_image: xcode10.1
addons:
  homebrew:
    packages:
      - llvm
      - cmake
    update: true

env:
  - PATH="/usr/local/opt/llvm/bin:${PATH}"

jobs:
  include:
    - stage: build
      script:
        - mkdir -p build && cd build
        - cmake .. -DCMAKE_INSTALL_PREFIX=../test/install -DBUILD_INTEGRATION_TESTS=OFF
        - make check install
        - pushd ../test && install/bin/tyr path.tyr -bind-lang=c -emit-llvm -out-dir=./c && popd
        - cmake .. -DCMAKE_INSTALL_PREFIX=../test/install -DBUILD_INTEGRATION_TESTS=ON
        - make c_test && ./test/c_test

